{
	"AWSTemplateFormatVersion" : "2010-09-09",

	"Description": {"Fn::Join" : [ " ", [
		"This is a test of the output of lambda functionality created with utils.template at the time it is generated during stack creation.",
		"The output is reflected in the name of an s3 bucket that is created. Would not be doing this if I knew how to",
		"output the data in a custom stack creation status message."
	]]},

	"Parameters" : {
	
	},

	"Resources" : {
		"Utils" : {
		    "Type" : "AWS::CloudFormation::Stack",
		    "Properties" : {
		        "TemplateURL" : "https://s3.amazonaws.com/kuali-research-ec2-setup/ecs/cloudformation/utils.template",
                "Parameters" : {
					"GlobalPrefix": "ECS-test",
					"Landscape": "qa"
				}
		    }
		},
				
        "ClusterSizeParms" : {
            "Type" : "Custom::Functions",
            "Properties" : {
				"ServiceToken" : "arn:aws:lambda:us-east-1:730096353738:function:LAMBDA-TEST-lambda-helper",
				"task" : "cluster-size",
                "parm1" : "3"
			}
        },
        
	   "S3Bucket" : {
		  "Type" : "AWS::S3::Bucket",
		  "Properties" : {
			 "AccessControl" : "PublicRead",
			 "BucketName" : {"Fn::Join" : [ "-", [ 
				"warrens", 
				{"Fn::GetAtt" : [ "ClusterSizeParms", "minSize"]}, 
				{"Fn::GetAtt" : [ "ClusterSizeParms", "maxSize"]}, 
				"test-bucket"
			 ]]},
			 "WebsiteConfiguration" : {
				"IndexDocument" : "index.htm"
			 }
		  },
		  "DeletionPolicy" : "Retain"
	   }
	},

	"Outputs" : {
	   "WebsiteURL" : {
		  "Value" : { "Fn::GetAtt" : [ "S3Bucket", "WebsiteURL" ] },
		  "Description" : "URL for website hosted on S3"
	   }
	}
}
